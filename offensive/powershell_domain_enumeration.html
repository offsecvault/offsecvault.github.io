<!DOCTYPE html>
<html lang="en-US">

<head>
  <title>offsecvault - Knowledge Base</title>
  <!--------------------->
  <!-- b0ydC owned. -->
  <!-- --------------- -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8" />

  <style>
    body {
      font-size: 12px;
      font-family: ubuntu mono;
      background-color: white;
      color: black;
      margin: 0;
    }

    a {
      color: black;
      font-weight: bold;
      text-decoration: none;
    }

    a:hover,
    a:active {
      color: #868686;
      text-decoration: underline;
    }
    table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
    }

    table.center {
    margin-left: auto; 
    margin-right: auto;
}
    
  </style>
</head>

<body>
  <pre><center>
<a href="/index.html" style="text-decoration:none;">
 ▒█████    █████▒ █████▒ ██████ ▓█████  ▄████▄ ██▒   █▓ ▄▄▄       █    ██  ██▓  ▄▄▄█████▓
▒██▒  ██▒▓██   ▒▓██   ▒▒██    ▒ ▓█   ▀ ▒██▀ ▀█▓██░   █▒▒████▄     ██  ▓██▒▓██▒  ▓  ██▒ ▓▒
▒██░  ██▒▒████ ░▒████ ░░ ▓██▄   ▒███   ▒▓█    ▄▓██  █▒░▒██  ▀█▄  ▓██  ▒██░▒██░  ▒ ▓██░ ▒░
▒██   ██░░▓█▒  ░░▓█▒  ░  ▒   ██▒▒▓█  ▄ ▒▓▓▄ ▄██▒▒██ █░░░██▄▄▄▄██ ▓▓█  ░██░▒██░  ░ ▓██▓ ░ 
░ ████▓▒░░▒█░   ░▒█░   ▒██████▒▒░▒████▒▒ ▓███▀ ░ ▒▀█░   ▓█   ▓██▒▒▒█████▓ ░██████▒▒██▒ ░ 
░ ▒░▒░▒░  ▒ ░    ▒ ░   ▒ ▒▓▒ ▒ ░░░ ▒░ ░░ ░▒ ▒  ░ ░ ▐░   ▒▒   ▓▒█░░▒▓▒ ▒ ▒ ░ ▒░▓  ░▒ ░░   
  ░ ▒ ▒░  ░      ░     ░ ░▒  ░ ░ ░ ░  ░  ░  ▒    ░ ░░    ▒   ▒▒ ░░░▒░ ░ ░ ░ ░ ▒  ░  ░    
░ ░ ░ ▒   ░ ░    ░ ░   ░  ░  ░     ░   ░           ░░    ░   ▒    ░░░ ░ ░   ░ ░   ░      
    ░ ░                      ░     ░  ░░ ░          ░        ░  ░   ░         ░  ░       
                                       ░           ░                                     
</a></pre>

<div style="font-size:24px; text-align:center; font-family:courier,monospace;">
    <a href="../../RED-TEAM.html">OFFENSIVE</a> |
    <a href="../../BLUE-TEAM.html">DEFENSIVE</a> |
    <a href="../../CTF.html">CTF</a> |
    <a href="../../TOOLS.html">TOOLS</a> |
    <a href="../../ABOUT.html">ABOUT</a> 
</div>
<pre style="text-align:center;">
<h3> Domain Enumeration | Powershell </h3>

using two tools [PowerView / ADModule]

<b>- active directory powershell module</b> 

<a href="https://github.com/samratashok/ADModule">ADModule | domain enumeration</a> 

<b>- bloodhound</b>

<a href="https://github.com/BloodHoundAD/BloodHound">BloodHound</a> 

<b>-powerview</b>

<a href="https://github.com/ZeroDayLab/PowerSploit/blob/master/Recon/PowerView.ps1">PowerView</a>

<b>-sharpview</b>

<a href="https://github.com/tevora-threat/SharpView/">SharpView</a>

<b>::: get current domain</b>

PS> Get-Domain | (powerview)
PS> Get-ADDomain | (active directory module)

<b>::: get object of another domain </b>

PS> Get-Domain -Domain <domain>

PS> Get-ADDomain -Identity <domain>

<b>::: get domain SID for the current domain</b>

PS> Get-DomainSID 

PS> (Get-ADDomain).DomainSID 

<b>::: get domain policy for current domain</b>

PS> Get-DomainPolicyData 
PS> Get-DomainPolicy

PS> (Get-DomainPolicyData).systemaccess 

<b>::: get domain policy for another domain</b>

PS> (Get-DomainPolicyData –domain <domain>).systemaccess

<b>::: get domain controller for the current domain</b>

PS> Get-DomainController

PS> Get-ADDomainController

<b>::: get domain controller for another domain</b>

PS> Get-DomainController -Domain <domainName>

PS> Get-ADDomainController -DomainName <domainName> -Discover

<b>::: get list of user in current domain</b>

PS> Get-DomainUser
PS> Get-DomainUser -Identity <user>

PS> Get-ADUser -Filter * -Properties *
PS> Get-ADUser -Identity <userName> -Properties *

<b>::: get list of users by name and its count</b>

PS> Get-DomainUser | select samaccountname | measure

<b>::: get list of properties of a user in current domain</b>

PS> Get-DomainUser -Identity <user> -Properties *
PS> Get-DomainUser -Properties samaccountname,logonCount | will help to retrieve and understand the normal activity of users 

PS> Get-ADUser -Filter * -Properties * | select -First 1 | Get-Member -MemberType *Property | select Name
PS> Get-ADUser -Filter * -Properties * | select name,logoncount,@{expression={[datetime]::fromFileTime($_.pwdlastset)}}

<b>::: search for a string in a user's attribute</b>

PS> Get-DomainUser -LDAPFilter "Description=*STRING*" | select name,Description

PS> Get-ADUser -Filter 'Description -like "*STRING*"' -Properties Description | select name,Description

<b>::: get a list of computers in the current domain</b>

PS> Get-DomainComputer | select Name
PS> Get-DomainComputer -OperatingSystem "*Server 2016*"
PS> Get-DomainComputer -Ping

PS> Get-ADComputer -Filter * | select Name
PS> Get-ADComputer -Filter * -Properties *
PS> Get-ADComputer -Filter 'OperatingSystem -like "*Server 2016*"' -Properties OperatingSystem | select Name,OperatingSystem
PS> Get-ADComputer -Filter * -Properties DNSHostname | %{Test-Connection -Count 1 -ComputerName $_.DNSHostName}

<b>::: get all groups in the current domain</b>

PS> Get-DomainGroup | select Name
PS> Get-DomainGroup -Domain <target_domain>

PS> Get-ADGroup -Filter * | select Name
PS> Get-ADGroup -Filter * -Properties *

<b>::: get all groups containing the word "admin" in group name</b>

PS> Get-DomainGroup *admin*

PS> Get-ADGroup -Filter 'Name -like "*admin*"' | select Name

<b>::: get all members of the domain admin group</b>

PS> Get-DomainGroupMember -Identity "Domain Admins" -Recurse

PS> Get-ADGroupMember -Identity "Domain Admins" -Recursive

<b>::: get the group membership for a user</b>

PS> Get-DomainGroup -UserName "<userName>"

PS> Get-ADPrincipalGroupMembership -Identity <userName>

<b>::: list all local groups on a machine (need admin rights on non-dc machines)</b>

PS> Get-NetLocalGroup -ComputerName <hostname> -ListGroups

<b>::: get members of all the local groups on a machine (need admin rights on non-dc machines)</b>

PS> Get-NetLocalGroup -ComputerName <hostname> -Recurse

<b>::: get members of all the local group "Administrators" on a machine (need admin rights on non-dc machines)</b>

PS> Get-NetLocalGroupMember -ComputerName <hostname> -GroupName Administrators

<b>::: get actively logged users on a computer (need local admin rights on the target)</b>

PS> Get-NetLoggedon -ComputerName <hostname>

<b>::: get locally logged users on a computer (need remote registry on the target - started by default on server OS)</b>

PS> Get-LoggedonLocal -ComputerName <hostname>

<b>::: get the last logged user on a computer (need admin righst and remote registry on the target)</b>

PS> Get-LastLoggedOn -ComputerName <hostname>

<b>::: find shares on hosts in current domain</b>

PS> Invoke-ShareFinder -Verbose

<b>::: find sensitive files on computers in the domain</b>

PS> Invoke-FileFinder -Verbose

<b>::: get all fileservers of the domain</b>

PS> Get-NetFileServer

<b>::: get kerberos policy</b>

PS> (Get-DomainPolicy).KerberosPolicy

<b>::: get domain admin_groups of forest </b>

PS> Get-DomainGroup *admin* -domain <forest/root> | select samaccountname

<b>-GPO-</b>

<b>::: get list of GPO in current domain</b>

PS> Get-DomainGPO
PS> Get-DomainGPO -ComputerIdentity <hostname>

<b>::: get GPO which use restricted groups or groups.xml for interesting users</b>

PS> Get-DomainGPOLocalGroup 

<b>::: get users which are in a local group of a machine using GPO</b>

PS> Get-DomainGPOComputerLocalGroupMapping -ComputerIdentity <hostname>

<b>::: get machines where the given user is member of a specific group</b>

PS> Get-DomainGPOUserLocalGroupMapping -Identity <user> -Verbose

<b>-OU-</b>

<b>::: get OU in a domain</b>

PS> Get-DomainOU

PS> Get-ADOrganizationalUnit -Filter * -Properties *

<b>::: get GPO applied on an OU. read GPOname from gplink attribute from Get-NetOU</b>

PS> Get-DomainGPO -Identity "gplink/cn"

<b>sample: </b>

PS> Get-DomainGPO -Identity {00000000-0000-0000-0000-000000000000}

<b>::: get attribute of an OU</b>

PS> (Get-DomainOU -Identity <OU>).attribute

<b>sample:</b>

PS> (Get-DomainOU -Identity Servers).gplink

<b>::: filter name on results</b>

PS> Get-DomainOU | select -ExpandProperty name

<b>::: list all computers in a specific OU</b>

PS> (Get-DomainOU -Identity [OUName]).distinguishedname | %{Get-DomainComputer -SearchBase $_} | select name

<b>-ACL-</b>

<b>::: enumerate ACL for domain admin group</b>

in case another domain group is needed, just change it...

PS> Get-DomainObjectAcl -Identity "Domain Admins" -ResolveGUIDs –Verbose

<b>::: get ACL associated with the specified object</b>

PS> Get-DomainObjectAcl -SamAccountName <username> -ResolveGUIDs

<b>::: get ACL associated with the specified prefix to be used for search</b>

PS> Get-DomainObjectAcl -SearchBase "STRING" -ResolveGUIDs -Verbose

<b>::: enumerate ACLs using ActiveDirectory Module</b> ***

PS> (Get-Acl 'AD:\CN=Administrator,CN-Users,CD=dollarcorp,DC=moneycorp,DC=local').Access

<b>::: search for interesting ACEs</b>

PS> Find-InterestingDomainAcl -ResolveGUIDs

<b>::: get ACL associated with specified path</b>

PS> Get-PathAcl -Path "\\<domain>\sysvol"

<b>::: show current ACL for a specific user</b>

PS> Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReferenceName -eq "<username>"}

<b>-TRUSTS-</b>

Is a relationship between two domains or forests which allows users of one domain or forest to 
access resources in the other domain or forest. 
Trust can be automatic (parent-child, same forest etc.) or established (forest, external). 

TDO / Trusted Domain Objects (represent the trust relation in a domain)

<b>::: get list of all domain trusts for the current domain</b>

PS> Get-DomainTrust
PS> Get-DomainTrust -Domain <domain>

PS> Get-ADTrust
PS> Get-ADTrust -Identity <domain>

<b>-FOREST-</b>

<b>::: get details about the current forest</b>

PS> Get-Forest
PS> Get-Forest -Forest <root/forest>

PS> Get-ADForest
PS> Get-ADForest - Identity <root/forest>

<b>::: get all domains in the current forest</b>

PS> Get-ForestDomain
PS> Get-ForestDomain -Forest <root/forest>

PS> (Get-ADForest).Domains

<b>::: get all global catalogs for the current forest</b>

PS> Get-ForestGlobalCatalog
PS> Get-ForestGlobalCatalog -Forest <root/forest>

PS> Get-ADForest | select -ExpandProperty GlobalCatalogs

<b>::: map trusts of a forest</b>

PS> Get-ForestTrust
PS> Get-ForestTrust -Forest <root/forest>

PS> Get-ADTrust -Filter 'msDS-TrustForestTrustInfo -ne "$null"'

</center>
</body>
</html>
